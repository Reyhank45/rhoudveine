set timeout=5
set default=0

menuentry "My OS" {
    # 1. Load video drivers (Critical for UEFI)
    insmod efi_gop
    insmod efi_uga
    insmod font
    if loadfont ${prefix}/fonts/unicode.pf2
    then
        insmod gfxterm
        set gfxmode=auto
        set gfxpayload=keep
        terminal_output gfxterm
    fi

    # 2. If the above fancy font stuff fails, fallbacks:
    insmod all_video
    
    # 3. Request automatic resolution
    set gfxmode=auto
    set gfxpayload=keep

    # 4. Boot
    multiboot2 /System/Rhoudveine/Booter/rhoudveine
    # Load init module so kernel can find it (cmdline matches init path)
    module /System/Rhoudveine/Booter/init /System/Rhoudveine/Booter/init
    boot
}

menuentry "My OS (Root /dev/sda)" {
    insmod efi_gop
    insmod efi_uga
    insmod font
    if loadfont ${prefix}/fonts/unicode.pf2
    then
        insmod gfxterm
        set gfxmode=auto
        set gfxpayload=keep
}

menuentry "My OS (Root UUID=F6DD-210C)" {
    insmod efi_gop
    insmod efi_uga
    insmod font
    if loadfont ${prefix}/fonts/unicode.pf2
    then
        insmod gfxterm
        set gfxmode=auto
        set gfxpayload=keep
        terminal_output gfxterm
    fi
    insmod all_video
    set gfxmode=auto
    set gfxpayload=keep

    multiboot2 /boot/rhoudveine root=UUID=F6DD-210C
    module2 /boot/init /System/Rhoudveine/Booter/init
    boot
}